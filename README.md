Тестовое задание для **MEDODS**.<br/>
Выполнил **Камлев Виталий**.

Исходный код сервиса авторизации лежит в папке __internal__. Код для запуска в папке __cmd__. В __Makefile__ написаны команды для сборки.<br/>
Для запуска сервиса авторизации на *Linux* необходимо  склонировать GitHub репозиторий. Далее в корень проекта необходимо добавить файл с названием __.env__. Ниже приведен пример этого файла:

```
HTTP_AUTH_HOST=localhost # Хост для подключения к сервису
HTTP_AUTH_PORT=8081 # Порт для подключения к сервису

REFRESH_TOKEN_DUR=10 # Время жизни refresh token'а в минутах
ACCESS_TOKEN_DUR=180 # Время жизни access token'а в минутах

MIGRATION_AUTH_DIR=./migrations/auth # # Папка с миграцией (не менять без перемещения файла)

CONTAINER_NAME=auth-db # Название контейнера
POSTGRES_AUTH_DB=auth # Название базы данных
POSTGRES_AUTH_USER=auth-user # Изер для подключения к БД
POSTGRES_AUTH_PASSWORD=auth-password # Пароль для подключения к БД
PORT_FROM=54323 # Порт на хосте (слушается контейнером)
PORT_TO=5432 # Порт для подключения к контейнеру
PG_AUTH_DSN=postgres://auth-user:auth-password@localhost:54323/auth?sslmode=disable # Data Source Name - подключение к БД из кода (формируется из переменных выше)

```
Причем ```MIGRATION_AUTH_DIR``` необходимо менять только если перемещается файл с миграцией.<br/>
Так же можно задать секретную подпись через переменные ```REFRESH_TOKEN_SEC``` и ```ACCESS_TOKEN_SEC```, однако в случае их отсутствия они сгенерируются сами при запуске сервиса и запишутся в этот же файл.<br/>
Для запуска нужно перейти в папку с проектом и в терминале и прописать следующие команды:<br/>
```make install-deps``` - скачаются необходимые утилиты<br/>
```docker-docker-compose up -d``` - поднимется docker-контейнер<br/>
```make local-migration-auth-up``` - развернется миграция в контейнере при помощи мигратора для указанных в __.env__  файле данных<br/>
```make run``` - запустим сервис на указанных в __.env__ хосте и порту<br/>
Так же можно посмотреть статус миграции и при необходимости сбросить ее командами ```make local-migration-auth-status``` и ```local-migration-auth-down``` соответственно (последняя не удаляет данные, так как они лежат в volume).<br/>
Логгирование будет происходить в файл **app.log** в папке **logs/**, находящейся в корне проекта.

Для обращения к сервису и получения **access_token** и **refresh_token** необходимо обратиться методом **POST** по адресу ```/Create``` с запросом:<br/>
```"guid" : "guid пользователя"```<br/>
Для обновления токенов нужно обратиться методом **PATCH** по адресу ```/Refresh``` с запросом вида:<br/>
```"refresh_token" : "полученный refresh_token из запроса Create"```<br/>
Гарантируется, что полученный **refresh_token** можно использовать для обновления токенов единожды.

Для запуска *unit-тестов* необходимо в корне проекта в терминале вызвать команды:<br/>
```make generate-test```<br/>
```make test-coverage```<br/>
После чего создастся файл **coverage** форматов *.out* и *.html*. Открыв последний, можно увидеть полный отчет по тестам, общий же процент покрытия будет написан в терминале. При запуске тестов логгировние будет происходить в ту же папку, что и при обычном запуске (**logs/**), только тепер в файл **app_test.log**.
